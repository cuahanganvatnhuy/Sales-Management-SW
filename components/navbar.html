<!-- Sidebar Navigation Component -->
<style>
/* Simple submenu styles with high specificity */
.sidebar ul li .submenu {
    display: none !important;
    list-style: none;
    padding: 0;
    margin: 8px 0 0 0;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    transition: all 0.3s ease;
    position: relative;
    z-index: 1000;
}

.sidebar ul li .submenu.show {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
}

.sidebar ul li .submenu li {
    margin: 0;
    padding: 0;
    list-style: none;
}

.sidebar ul li .submenu a {
    display: block !important;
    padding: 12px 20px 12px 40px;
    color: rgba(255, 255, 255, 0.9) !important;
    text-decoration: none;
    font-size: 14px;
    transition: all 0.3s ease;
    border-left: 3px solid transparent;
    background: transparent;
    width: 100%;
    box-sizing: border-box;
}

.sidebar ul li .submenu a:hover {
    background: rgba(255, 255, 255, 0.1) !important;
    border-left-color: #4CAF50;
    color: #fff !important;
}

.sidebar ul li .submenu a i {
    margin-right: 8px;
    width: 16px;
    text-align: center;
}

.submenu-toggle {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
}
</style>
<nav class="sidebar">
    <div class="sidebar-header">
        <div class="logo">
            <i class="fas fa-shopping-cart"></i>
            <span>PMQLDH</span>
        </div>
    </div>
    <ul class="sidebar-menu">
        <li id="nav-home"><a href="/index.html"><i class="fas fa-home"></i> <span>Dashboard</span></a></li>
        <li id="nav-products"><a href="/view/products.html" data-page="products.html"><i class="fas fa-box"></i> <span>Sản Phẩm</span></a></li>
        <li id="nav-orders">
            <a href="/view/orders.html" data-page="orders.html">
                <i class="fas fa-plus-circle"></i>
                <span>Tạo Đơn Hàng</span>
            </a>
        </li>
        <li id="nav-order-management">
            <a href="/view/order-management.html" data-page="order-management.html">
                <i class="fas fa-tasks"></i>
                <span>Quản Lý Đơn Hàng</span>
            </a>
        </li>
        <li id="nav-stores"><a href="/view/stores.html" data-page="stores.html"><i class="fas fa-store"></i> <span>Cửa Hàng</span></a></li>
        <li id="nav-reports"><a href="/view/reports.html" data-page="reports.html"><i class="fas fa-chart-bar"></i> <span>Báo Cáo</span></a></li>
        <li class="has-submenu">
            <script>
                // Immediate fallback - ensure function is available right away
                if (!window.navigateToInvoice) {
                    window.navigateToInvoice = function(type) {
                        console.log('=== NAVIGATION DEBUG ===');
                        console.log('Type:', type);
                        console.log('Current URL:', window.location.href);
                        console.log('Current pathname:', window.location.pathname);
                        
                        const currentPath = window.location.pathname;
                        const isInRoot = currentPath === '/' || currentPath.endsWith('/index.html') || currentPath.includes('/index.html');
                        
                        console.log('Is in root?', isInRoot);
                        
                        let targetUrl;
                        if (type === 'global') {
                            targetUrl = isInRoot ? 'view/global-invoice.html' : 'global-invoice.html';
                        } else {
                            targetUrl = isInRoot ? 'view/store-invoice.html' : 'store-invoice.html';
                        }
                        
                        console.log('Target URL:', targetUrl);
                        console.log('Full target URL:', window.location.origin + '/' + targetUrl);
                        console.log('About to navigate...');
                        
                        window.location.href = targetUrl;
                    };
                    console.log('navigateToInvoice function registered from immediate fallback');
                }
            </script>
            <a href="#" class="nav-link" onclick="toggleSubmenu(event)">
                <i class="fas fa-file-invoice-dollar"></i>
                <span>Quản Lý Hóa Đơn</span>
                <i class="fas fa-chevron-down" style="margin-left: auto; font-size: 12px;"></i>
            </a>
            <ul id="invoiceSubmenu" style="display: none; list-style: none; padding: 0; margin: 8px 0 0 0; background: rgba(255, 255, 255, 0.1); border-radius: 8px;">
                <li style="margin: 0; padding: 0;">
                    <a href="#" onclick="event.preventDefault(); navigateToInvoice('global'); return false;" style="display: block; padding: 12px 20px 12px 40px; color: rgba(255, 255, 255, 0.9); text-decoration: none; font-size: 14px; border-left: 3px solid transparent; cursor: pointer;">
                        <i class="fas fa-globe" style="margin-right: 8px; width: 16px;"></i> 
                        Hóa Đơn Toàn Bộ
                    </a>
                </li>
                <li style="margin: 0; padding: 0;">
                    <a href="#" onclick="event.preventDefault(); navigateToInvoice('store'); return false;" style="display: block; padding: 12px 20px 12px 40px; color: rgba(255, 255, 255, 0.9); text-decoration: none; font-size: 14px; border-left: 3px solid transparent; cursor: pointer;">
                        <i class="fas fa-store" style="margin-right: 8px; width: 16px;"></i> 
                        Hóa Đơn Từng Cửa Hàng
                    </a>
                </li>
            </ul>
        </li>
        <li id="nav-settings"><a href="/view/settings.html" data-page="settings.html"><i class="fas fa-cog"></i> <span>Cài Đặt</span></a></li>
    </ul>

    <script>
        // Global submenu toggle function - works on all pages
        window.toggleSubmenu = function(event) {
            event.preventDefault();
            console.log('Toggle submenu clicked from navbar component');
            
            const submenu = document.getElementById('invoiceSubmenu');
            if (submenu) {
                const isHidden = submenu.style.display === 'none' || submenu.style.display === '';
                
                if (isHidden) {
                    submenu.style.display = 'block';
                    console.log('Submenu shown');
                } else {
                    submenu.style.display = 'none';
                    console.log('Submenu hidden');
                }
            } else {
                console.log('Submenu not found!');
            }
        };
        

        
        // Dynamic link adjustment based on current path
        document.addEventListener('DOMContentLoaded', function() {
            const currentPath = window.location.pathname;
            const isInRoot = currentPath === '/' || currentPath.endsWith('/index.html') || currentPath.includes('/index.html');
            
            // Get all navigation links
            const navLinks = document.querySelectorAll('.sidebar a[data-page]');
            
            navLinks.forEach(link => {
                const page = link.getAttribute('data-page');
                if (page && !link.href.includes('#')) {
                    if (isInRoot) {
                        // From root (dashboard), add 'view/' prefix
                        link.href = 'view/' + page;
                    } else {
                        // From view/ pages, use relative path
                        link.href = page;
                    }
                }
            });
            
            // Close submenu when clicking outside
            document.addEventListener('click', function(e) {
                const submenu = document.getElementById('invoiceSubmenu');
                const hasSubmenu = e.target.closest('.has-submenu');
                
                if (submenu && !hasSubmenu) {
                    submenu.style.display = 'none';
                    console.log('Submenu closed by clicking outside');
                }
            });
        });
    </script>
</nav>