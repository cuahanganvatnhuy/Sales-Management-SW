<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω Kho - PMQLDH</title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../style/man.css">
    <link rel="stylesheet" href="../style/warehouse-management.css">

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <!-- Loading Overlay -->
        <div id="loadingOverlay" class="loading-overlay hidden">
            <div class="loading-spinner">
                <i class="fas fa-spinner fa-spin"></i>
                <p>ƒêang x·ª≠ l√Ω...</p>
            </div>
        </div>

        <!-- Notification -->
        <div id="notification" class="notification hidden">
            <div class="notification-content">
                <i class="notification-icon"></i>
                <span class="notification-message"></span>
            </div>
        </div>

        <!-- Sidebar Container -->
        <div id="navbar-container">
            <!-- Navbar will be loaded here -->
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header Component -->
            <div id="header-container">
                <!-- Header will be loaded here -->
            </div>

            <!-- Content -->
            <div class="content">
                <!-- Dashboard Overview -->
        <section class="warehouse-dashboard">
            <div class="dashboard-cards">
                <div class="dashboard-card">
                    <div class="card-icon total">
                        <i class="fas fa-boxes"></i>
                    </div>
                    <div class="card-content">
                        <h3 id="totalProducts">0</h3>
                        <p>T·ªïng S·∫£n Ph·∫©m</p>
                    </div>
                </div>
                <div class="dashboard-card">
                    <div class="card-icon value">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="card-content">
                        <h3 id="totalValue">0 VNƒê</h3>
                        <p>Gi√° Tr·ªã Kho</p>
                    </div>
                </div>
                <div class="dashboard-card">
                    <div class="card-icon low">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="card-content">
                        <h3 id="lowStockCount">0</h3>
                        <p>S·∫Øp H·∫øt H√†ng</p>
                    </div>
                </div>
                <div class="dashboard-card">
                    <div class="card-icon out">
                        <i class="fas fa-times-circle"></i>
                    </div>
                    <div class="card-content">
                        <h3 id="outOfStockCount">0</h3>
                        <p>H·∫øt H√†ng</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Action Buttons -->
        <section class="warehouse-actions">
            <div class="action-buttons">
                <button type="button" class="btn btn-primary" onclick="openStockInModal()">
                    <i class="fas fa-plus-circle"></i>
                    Nh·∫≠p Kho
                </button>
                <button type="button" class="btn btn-secondary" onclick="openStockOutModal()">
                    <i class="fas fa-minus-circle"></i>
                    Xu·∫•t Kho
                </button>
                <button type="button" class="btn btn-info" onclick="openAdjustmentModal()">
                    <i class="fas fa-edit"></i>
                    ƒêi·ªÅu Ch·ªânh
                </button>
                <button type="button" class="btn btn-success" onclick="exportWarehouseReport()">
                    <i class="fas fa-file-excel"></i>
                    Xu·∫•t B√°o C√°o
                </button>
               
            </div>
        </section>

        <!-- Filters -->
        <section class="warehouse-filters">
            <div class="filter-container">
                <div class="filter-group">
                    <label for="categoryFilter">Danh M·ª•c:</label>
                    <select id="categoryFilter" onchange="applyFilters()">
                        <option value="">T·∫•t c·∫£ danh m·ª•c</option>
                    </select>
                  
                </div>
                <div class="filter-group">
                    <label for="stockStatusFilter">Tr·∫°ng Th√°i:</label>
                    <select id="stockStatusFilter" onchange="applyFilters()">
                        <option value="">T·∫•t c·∫£</option>
                        <option value="in_stock">C√≤n h√†ng</option>
                        <option value="low_stock">S·∫Øp h·∫øt</option>
                        <option value="out_of_stock">H·∫øt h√†ng</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="searchInput">T√¨m ki·∫øm:</label>
                    <input type="text" id="searchInput" placeholder="T√™n s·∫£n ph·∫©m, SKU..." onkeyup="applyFilters()">
                </div>
            </div>
        </section>
        <section>
          <div class="view-toggle-buttons">
            <button id="currentListViewBtn" class="btn btn-primary active" onclick="switchToCurrentListView()">Danh s√°ch hi·ªán t·∫°i</button>
            <button id="usageReportViewBtn" class="btn btn-secondary" onclick="switchToUsageReportView()">B√°o c√°o s·ª≠ d·ª•ng</button>
          </div>
        </section>
        <!-- Warehouse Table -->

        <section class="warehouse-table-section" id="warehouseListView">
            <button type="button" class="btn btn-danger bulk-delete-btn" id="deleteSelectedBtn" onclick="deleteSelectedProducts()" disabled>
                <i class="fas fa-trash"></i>
                X√≥a ƒê√£ Ch·ªçn (<span id="selectedCount">0</span>)
            </button>
            <div class="table-container">
                <table class="warehouse-table">
                    <thead>
                        <tr>
                            <th>
                                <input type="checkbox" id="selectAll" onchange="toggleSelectAll()">
                            </th>
                            <th>STT</th>
                            <th>S·∫£n Ph·∫©m</th>
                            <th>SKU</th>
                            <th>Danh M·ª•c</th>
                            <th>ƒê∆°n V·ªã</th>
                            <th>T·ªìn Kho</th>
                            <th>Gi√° Nh·∫≠p</th>
                            <th>Gi√° Tr·ªã</th>
                            <th>Tr·∫°ng Th√°i</th>
                            <th>Thao T√°c</th>
                        </tr>
                    </thead>
                    <tbody id="warehouseTableBody">
                        <!-- Data will be populated here -->
                    </tbody>
                </table>
            </div>

            <!-- Empty State -->
            <div id="warehouseEmptyState" class="empty-state hidden">
                <div class="empty-icon">
                    <i class="fas fa-warehouse"></i>
                </div>
                <h3>Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o trong kho</h3>
                <p>H√£y th√™m s·∫£n ph·∫©m ƒë·∫ßu ti√™n v√†o kho!</p>
            </div>
        </section>

        <!-- Charts Section -->
        <section class="warehouse-charts">
            <div class="charts-container">
                <div class="chart-card">
                    <h3>Ph√¢n B·ªë Theo Danh M·ª•c</h3>
                    <canvas id="categoryChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Top S·∫£n Ph·∫©m Theo Gi√° Tr·ªã</h3>
                    <canvas id="valueChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Warehouse Usage Report View -->
        <section id="warehouseUsageReportView" class="warehouse-usage-report" style="display: none;">
            <!-- Report Filters -->
            <div class="report-filters">
                <div class="filter-row">
                    <div class="filter-group">
                        <label for="reportPeriodSelect">üìÖ Th·ªùi gian:</label>
                        <select id="reportPeriodSelect" onchange="generateUsageReport()">
                            <option value="today">H√¥m nay</option>
                            <option value="week" selected>Tu·∫ßn n√†y</option>
                            <option value="month">Th√°ng n√†y</option>
                            <option value="quarter">Qu√Ω n√†y</option>
                            <option value="year">NƒÉm n√†y</option>
                            <option value="custom">T√πy ch·ªânh</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="reportStoreSelect">üè™ C·ª≠a h√†ng:</label>
                        <select id="reportStoreSelect" onchange="generateUsageReport()">
                            <option value="all">T·∫•t c·∫£ c·ª≠a h√†ng</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="reportCategorySelect">üì¶ Danh m·ª•c:</label>
                        <select id="reportCategorySelect" onchange="generateUsageReport()">
                            <option value="all">T·∫•t c·∫£ danh m·ª•c</option>
                        </select>
                    </div>
                </div>
                <div class="filter-row">
                    <div class="date-range-display">
                        <span>üìä B√°o c√°o t·ª´: <strong id="reportDateRange">Loading...</strong></span>
                    </div>
                    <div class="report-actions">
                        <button class="btn btn-primary" onclick="generateUsageReport()">
                            <i class="fas fa-sync-alt"></i> L√†m m·ªõi
                        </button>
                        <button class="btn btn-success" onclick="exportUsageReport()">
                            <i class="fas fa-download"></i> Xu·∫•t Excel
                        </button>
                        <button class="btn btn-info" onclick="printUsageReport()">
                            <i class="fas fa-print"></i> In b√°o c√°o
                        </button>
                    </div>
                </div>
            </div>

            <!-- Usage Summary Cards -->
            <div class="usage-summary-cards">
                <div class="summary-card total-movements">
                    <div class="card-icon">
                        <i class="fas fa-exchange-alt"></i>
                    </div>
                    <div class="card-content">
                        <h3 id="totalMovements">0</h3>
                        <p>T·ªïng giao d·ªãch</p>
                        <small class="card-subtitle">Nh·∫≠p + Xu·∫•t kho</small>
                    </div>
                </div>
                <div class="summary-card stock-in">
                    <div class="card-icon">
                        <i class="fas fa-arrow-up"></i>
                    </div>
                    <div class="card-content">
                        <h3 id="totalStockIn">0</h3>
                        <p>T·ªïng nh·∫≠p kho</p>
                        <small class="card-subtitle">S·ªë l∆∞·ª£ng s·∫£n ph·∫©m</small>
                    </div>
                </div>
                <div class="summary-card stock-out">
                    <div class="card-icon">
                        <i class="fas fa-arrow-down"></i>
                    </div>
                    <div class="card-content">
                        <h3 id="totalStockOut">0</h3>
                        <p>T·ªïng xu·∫•t kho</p>
                        <small class="card-subtitle">S·ªë l∆∞·ª£ng s·∫£n ph·∫©m</small>
                    </div>
                </div>
                <div class="summary-card usage-value">
                    <div class="card-icon">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="card-content">
                        <h3 id="totalUsageValue">0ƒë</h3>
                        <p>Gi√° tr·ªã s·ª≠ d·ª•ng</p>
                        <small class="card-subtitle">T·ªïng gi√° tr·ªã xu·∫•t kho</small>
                    </div>
                </div>
            </div>

            <!-- Usage Report Tables -->
            <div class="usage-report-tables">
                <!-- Product Usage Table -->
                <div class="report-table-container">
                    <div class="table-header">
                        <h3>üì¶ B√°o c√°o s·ª≠ d·ª•ng theo s·∫£n ph·∫©m</h3>
                        <div class="table-controls">
                            <input type="text" id="productUsageSearch" placeholder="üîç T√¨m ki·∫øm s·∫£n ph·∫©m..." onkeyup="filterUsageTable('productUsage')">
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="usage-table" id="productUsageTable">
                            <thead>
                                <tr>
                                    <th>STT</th>
                                    <th>S·∫£n ph·∫©m</th>
                                    <th>SKU</th>
                                    <th>Danh m·ª•c</th>
                                    <th>T·ªìn ƒë·∫ßu k·ª≥</th>
                                    <th>Nh·∫≠p kho</th>
                                    <th>Xu·∫•t kho</th>
                                    <th>T·ªìn cu·ªëi k·ª≥</th>
                                    <th>% S·ª≠ d·ª•ng</th>
                                    <th>Gi√° tr·ªã xu·∫•t</th>
                                </tr>
                            </thead>
                            <tbody id="productUsageTableBody">
                                <!-- Data will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Transaction History Table -->
                <div class="report-table-container">
                    <div class="table-header">
                        <h3>üìã L·ªãch s·ª≠ giao d·ªãch kho</h3>
                        <div class="table-controls">
                            <select id="transactionTypeFilter" onchange="filterUsageTable('transactionHistory')">
                                <option value="all">T·∫•t c·∫£ giao d·ªãch</option>
                                <option value="in">Ch·ªâ nh·∫≠p kho</option>
                                <option value="out">Ch·ªâ xu·∫•t kho</option>
                                <option value="adjustment">Ch·ªâ ƒëi·ªÅu ch·ªânh</option>
                            </select>
                            <input type="text" id="transactionSearch" placeholder="üîç T√¨m ki·∫øm giao d·ªãch..." onkeyup="filterUsageTable('transactionHistory')">
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="usage-table" id="transactionHistoryTable">
                            <thead>
                                <tr>
                                    <th>STT</th>
                                    <th>Th·ªùi gian</th>
                                    <th>Lo·∫°i</th>
                                    <th>S·∫£n ph·∫©m</th>
                                    <th>SKU</th>
                                    <th>S·ªë l∆∞·ª£ng</th>
                                    <th>ƒê∆°n gi√°</th>
                                    <th>T·ªïng gi√° tr·ªã</th>
                                    <th>L√Ω do</th>
                                    <th>Ng∆∞·ªùi th·ª±c hi·ªán</th>
                                </tr>
                            </thead>
                            <tbody id="transactionHistoryTableBody">
                                <!-- Data will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Usage Charts -->
            <div class="usage-charts">
                <div class="chart-container">
                    <div class="chart-card">
                        <h3>üìä Bi·ªÉu ƒë·ªì nh·∫≠p/xu·∫•t kho theo th·ªùi gian</h3>
                        <canvas id="usageTimeChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>ü•ß Top s·∫£n ph·∫©m xu·∫•t kho nhi·ªÅu nh·∫•t</h3>
                        <canvas id="topUsageChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Empty State -->
            <div id="usageReportEmptyState" class="empty-state hidden">
                <div class="empty-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <h3>Ch∆∞a c√≥ d·ªØ li·ªáu s·ª≠ d·ª•ng kho</h3>
                <p>Th·ª±c hi·ªán c√°c giao d·ªãch nh·∫≠p/xu·∫•t kho ƒë·ªÉ xem b√°o c√°o!</p>
            </div>
        </section>

    <!-- Stock In Modal -->
    <div id="stockInModal" class="modal large-modal">
        <div class="modal-content">
            <form id="stockInForm" onsubmit="processStockIn(event)">
                <div class="modal-header">
                    <h3>Nh·∫≠p Kho - T·∫°o S·∫£n Ph·∫©m M·ªõi</h3>
                    <span class="close" onclick="closeStockInModal()">&times;</span>
                </div>
                <div class="modal-body">
                    <!-- Th√¥ng tin c∆° b·∫£n -->
                    <div class="form-group">
                        <label for="newProductName">T√™n s·∫£n ph·∫©m:</label>
                        <input type="text" id="newProductName" name="newProductName" placeholder="T√™n s·∫£n ph·∫©m" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newProductSku">SKU:</label>
                            <input type="text" id="newProductSku" name="newProductSku" placeholder="M√£ SKU (t√πy ch·ªçn)">
                        </div>
                        <div class="form-group">
                            <label for="stockInUnitPrice">Gi√° s·∫£n ph·∫©m (ƒë):</label>
                            <input type="number" id="stockInUnitPrice" name="stockInUnitPrice" step="0.01" min="0" placeholder="Nh·∫≠p gi√° s·∫£n ph·∫©m" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newProductCategory">Ch·ªçn danh m·ª•c:</label>
                            <select id="newProductCategory" name="newProductCategory" required>
                                <option value="">-- Ch·ªçn danh m·ª•c s·∫£n ph·∫©m --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="newProductUnit">ƒê∆°n v·ªã t√≠nh:</label>
                            <select id="newProductUnit" name="newProductUnit" required>
                                <option value="">-- Ch·ªçn ƒë∆°n v·ªã t√≠nh --</option>
                                
                                <option value="kg">Kilogram (kg)</option>
                                <option value="g">Gram (g)</option>
                                <option value="l√≠t">L√≠t</option>
                                <option value="ml">Mililit (ml)</option>
                                <option value="m">M√©t (m)</option>
                                <option value="cm">Centimet (cm)</option>
                                <option value="th√πng">Th√πng</option>
                                <option value="h·ªôp">H·ªôp</option>
                                <option value="chai">Chai</option>
                                <option value="chi·∫øc">Chi·∫øc</option>
                                <option value="c√°i">C√°i</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="stockInQuantity">S·ªë l∆∞·ª£ng t·ªìn kho:</label>
                            <input type="number" id="stockInQuantity" name="stockInQuantity" step="0.01" required min="0.01" placeholder="Nh·∫≠p s·ªë l∆∞·ª£ng t·ªìn kho">
                        </div>
                        <div class="form-group">
                            <label for="newProductConversion">Quy ƒë·ªïi (t√πy ch·ªçn):</label>
                            <input type="text" id="newProductConversion" name="newProductConversion" placeholder="VD: 1kg = 1000g">
                        </div>
                    </div>
                    
                    <!-- Th√¥ng tin b·ªï sung -->
                    <div class="form-group">
                        <label for="newProductDescription">M√¥ t·∫£ s·∫£n ph·∫©m:</label>
                        <textarea id="newProductDescription" name="newProductDescription" placeholder="M√¥ t·∫£ chi ti·∫øt v·ªÅ s·∫£n ph·∫©m (t√πy ch·ªçn)" rows="2"></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="stockInSupplier">Nh√† Cung C·∫•p:</label>
                            <input type="text" id="stockInSupplier" name="stockInSupplier" placeholder="T√™n nh√† cung c·∫•p (t√πy ch·ªçn)">
                        </div>
                        <div class="form-group">
                            <label for="stockInNote">Ghi Ch√∫:</label>
                            <input type="text" id="stockInNote" name="stockInNote" placeholder="Ghi ch√∫ th√™m (t√πy ch·ªçn)">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeStockInModal()">H·ªßy</button>
                    <button type="submit" class="btn btn-primary">Nh·∫≠p Kho</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Stock Out Modal -->
    <div id="stockOutModal" class="modal modern-modal">
        <div class="modal-overlay"></div>
        <div class="modal-content stock-out-modal">
            <div class="modal-header gradient-header">
                <div class="header-content">
                    <div class="header-icon">
                        <i class="fas fa-minus-circle"></i>
                    </div>
                    <div class="header-text">
                        <h2>üì¶ Xu·∫•t Kho</h2>
                        <p>Qu·∫£n l√Ω xu·∫•t h√†ng kh·ªèi kho</p>
                    </div>
                </div>
                <button type="button" class="close-btn modern-close" onclick="closeStockOutModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="stockOutForm" onsubmit="processStockOut(event)">
                <div class="modal-body modern-body">
                    <!-- Product Selection Card -->
                    <div class="info-card product-card">
                        <div class="card-header">
                            <i class="fas fa-box"></i>
                            <h4>Th√¥ng Tin S·∫£n Ph·∫©m</h4>
                        </div>
                        <div class="card-content">
                            <div class="form-group">
                                <label for="stockOutProduct">
                                    <i class="fas fa-search"></i>
                                    Ch·ªçn S·∫£n Ph·∫©m:
                                </label>
                                <select id="stockOutProduct" name="stockOutProduct" required onchange="updateStockOutProductInfo()" class="modern-select">
                                    <option value="">üîç T√¨m v√† ch·ªçn s·∫£n ph·∫©m...</option>
                                </select>
                            </div>
                            
                            <div class="stock-info-display" id="stockInfoDisplay" style="display: none;">
                                <div class="stock-info-item">
                                    <span class="info-label">üìä T·ªìn kho hi·ªán t·∫°i:</span>
                                    <span class="info-value" id="stockOutCurrentStock">0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Export Details Card -->
                    <div class="info-card export-card">
                        <div class="card-header">
                            <i class="fas fa-shipping-fast"></i>
                            <h4>Chi Ti·∫øt Xu·∫•t Kho</h4>
                        </div>
                        <div class="card-content">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="stockOutQuantity">
                                        <i class="fas fa-calculator"></i>
                                        S·ªë L∆∞·ª£ng Xu·∫•t:
                                    </label>
                                    <input type="number" id="stockOutQuantity" name="stockOutQuantity" 
                                           step="0.01" required min="0.01" 
                                           placeholder="Nh·∫≠p s·ªë l∆∞·ª£ng c·∫ßn xu·∫•t" 
                                           class="modern-input quantity-input">
                                </div>
                                
                                <div class="form-group">
                                    <label for="stockOutReason">
                                        <i class="fas fa-clipboard-list"></i>
                                        L√Ω Do Xu·∫•t:
                                    </label>
                                    <select id="stockOutReason" name="stockOutReason" required onchange="toggleCustomReason()" class="modern-select">
                                        <option value="">üìã Ch·ªçn l√Ω do xu·∫•t kho...</option>
                                        <option value="sale">üí∞ B√°n h√†ng</option>
                                        <option value="damaged">üîß H·ªèng h√≥c</option>
                                        <option value="expired">‚è∞ H·∫øt h·∫°n</option>
                                        <option value="lost">‚ùå M·∫•t m√°t</option>
                                        <option value="promotion">üéÅ Khuy·∫øn m√£i</option>
                                        <option value="other">‚úèÔ∏è Kh√°c</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- Custom Reason Input (hidden by default) -->
                            <div class="form-group" id="customReasonGroup" style="display: none;">
                                <label for="stockOutCustomReason">
                                    <i class="fas fa-edit"></i>
                                    L√Ω do c·ª• th·ªÉ:
                                </label>
                                <input type="text" id="stockOutCustomReason" name="stockOutCustomReason" 
                                       placeholder="Nh·∫≠p l√Ω do c·ª• th·ªÉ..." class="modern-input">
                            </div>
                        </div>
                    </div>

                    <!-- Notes Card -->
                    <div class="info-card notes-card">
                        <div class="card-header">
                            <i class="fas fa-sticky-note"></i>
                            <h4>Ghi Ch√∫</h4>
                        </div>
                        <div class="card-content">
                            <div class="form-group">
                                <label for="stockOutNote">
                                    <i class="fas fa-comment-alt"></i>
                                    Ghi ch√∫ th√™m:
                                </label>
                                <textarea id="stockOutNote" name="stockOutNote" 
                                         placeholder="üí¨ Th√™m ghi ch√∫ v·ªÅ vi·ªác xu·∫•t kho n√†y..." 
                                         class="modern-textarea" rows="3"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="modal-footer modern-footer">
                    <button type="button" class="btn btn-cancel" onclick="closeStockOutModal()">
                        <i class="fas fa-times"></i>
                        H·ªßy B·ªè
                    </button>
                    <button type="submit" class="btn btn-export">
                        <i class="fas fa-minus-circle"></i>
                        Xu·∫•t Kho
                    </button>
                    <button type="button" class="btn btn-print" id="printReceiptBtn">
                        <i class="fas fa-print"></i>
                        In Phi·∫øu
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Adjustment Modal -->
    <div id="adjustmentModal" class="modal large-modal">
        <div class="modal-content">
            <form id="adjustmentForm" onsubmit="processAdjustment(event)">
                <div class="modal-header">
                    <h3><i class="fas fa-edit"></i> ƒêi·ªÅu Ch·ªânh S·∫£n Ph·∫©m</h3>
                    <span class="close" onclick="closeAdjustmentModal()">&times;</span>
                </div>
                <div class="modal-body">
                    <!-- Ch·ªçn s·∫£n ph·∫©m ƒë·ªÉ ƒëi·ªÅu ch·ªânh -->
                    <div class="form-group">
                        <label for="adjustmentProduct">Ch·ªçn S·∫£n Ph·∫©m C·∫ßn ƒêi·ªÅu Ch·ªânh:</label>
                        <select id="adjustmentProduct" required onchange="loadProductForAdjustment()">
                            <option value="">-- Ch·ªçn s·∫£n ph·∫©m c·∫ßn ƒëi·ªÅu ch·ªânh --</option>
                        </select>
                    </div>
                    
                    <!-- Th√¥ng tin c∆° b·∫£n -->
                    <div class="form-group">
                        <label for="adjustProductName">T√™n s·∫£n ph·∫©m:</label>
                        <input type="text" id="adjustProductName" name="adjustProductName" placeholder="T√™n s·∫£n ph·∫©m" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="adjustProductSku">SKU:</label>
                            <input type="text" id="adjustProductSku" name="adjustProductSku" placeholder="M√£ SKU (t√πy ch·ªçn)">
                        </div>
                        <div class="form-group">
                            <label for="adjustUnitPrice">Gi√° s·∫£n ph·∫©m (ƒë):</label>
                            <input type="number" id="adjustUnitPrice" name="adjustUnitPrice" step="0.01" min="0" placeholder="Nh·∫≠p gi√° s·∫£n ph·∫©m" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="adjustProductCategory">Ch·ªçn danh m·ª•c:</label>
                            <select id="adjustProductCategory" name="adjustProductCategory" required>
                                <option value="">-- Ch·ªçn danh m·ª•c s·∫£n ph·∫©m --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="adjustProductUnit">ƒê∆°n v·ªã t√≠nh:</label>
                            <select id="adjustProductUnit" name="adjustProductUnit" required>
                                <option value="">-- Ch·ªçn ƒë∆°n v·ªã t√≠nh --</option>
                                <option value="c√°i">C√°i</option>
                                <option value="kg">Kilogram (kg)</option>
                                <option value="g">Gram (g)</option>
                                <option value="l√≠t">L√≠t</option>
                                <option value="ml">Mililit (ml)</option>
                                <option value="m">M√©t (m)</option>
                                <option value="cm">Centimet (cm)</option>
                                <option value="th√πng">Th√πng</option>
                                <option value="h·ªôp">H·ªôp</option>
                                <option value="chai">Chai</option>
                                <option value="chi·∫øc">Chi·∫øc</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="currentStock">T·ªìn kho hi·ªán t·∫°i:</label>
                            <input type="text" id="currentStock" readonly style="background-color: #f8f9fa;">
                        </div>
                        <div class="form-group">
                            <label for="adjustQuantity">S·ªë l∆∞·ª£ng t·ªìn kho m·ªõi:</label>
                            <input type="number" id="adjustQuantity" name="adjustQuantity" step="0.01" required min="0" placeholder="Nh·∫≠p s·ªë l∆∞·ª£ng t·ªìn kho m·ªõi">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="adjustProductConversion">Quy ƒë·ªïi (t√πy ch·ªçn):</label>
                        <input type="text" id="adjustProductConversion" name="adjustProductConversion" placeholder="VD: 1kg = 1000g">
                    </div>
                    
                    <!-- Th√¥ng tin b·ªï sung -->
                    <div class="form-group">
                        <label for="adjustProductDescription">M√¥ t·∫£ s·∫£n ph·∫©m:</label>
                        <textarea id="adjustProductDescription" name="adjustProductDescription" placeholder="M√¥ t·∫£ chi ti·∫øt v·ªÅ s·∫£n ph·∫©m (t√πy ch·ªçn)" rows="2"></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="adjustSupplier">Nh√† Cung C·∫•p:</label>
                            <input type="text" id="adjustSupplier" name="adjustSupplier" placeholder="T√™n nh√† cung c·∫•p (t√πy ch·ªçn)">
                        </div>
                        <div class="form-group">
                            <label for="adjustmentReason">L√Ω do ƒëi·ªÅu ch·ªânh:</label>
                            <select id="adjustmentReason" name="adjustmentReason">
                                <option value="">-- Ch·ªçn l√Ω do ƒëi·ªÅu ch·ªânh --</option>
                                <option value="inventory">Ki·ªÉm k√™ ƒë·ªãnh k·ª≥</option>
                                <option value="correction">S·ª≠a l·ªói th√¥ng tin</option>
                                <option value="price_update">C·∫≠p nh·∫≠t gi√°</option>
                                <option value="info_update">C·∫≠p nh·∫≠t th√¥ng tin</option>
                                <option value="damage">H√†ng h·ªèng/m·∫•t m√°t</option>
                                <option value="found">T√¨m th·∫•y h√†ng t·ªìn</option>
                                <option value="other">L√Ω do kh√°c</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="adjustmentNote">Ghi ch√∫ ƒëi·ªÅu ch·ªânh:</label>
                        <textarea id="adjustmentNote" name="adjustmentNote" placeholder="Ghi ch√∫ chi ti·∫øt v·ªÅ vi·ªác ƒëi·ªÅu ch·ªânh..." rows="2"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeAdjustmentModal()">H·ªßy</button>
                    <button type="submit" class="btn btn-warning"><i class="fas fa-save"></i> C·∫≠p Nh·∫≠t S·∫£n Ph·∫©m</button>
                </div>
            </form>
        </div>
    </div>

        </div>
        </main>
    </div>

    <!-- Print Confirmation Modal -->
    <div id="printConfirmModal" class="modal modern-modal">
        <div class="modal-overlay"></div>
        <div class="modal-content print-confirm-modal">
            <div class="modal-header gradient-header">
                <div class="header-content">
                    <div class="header-icon">
                        <i class="fas fa-print"></i>
                    </div>
                    <div class="header-text">
                        <h3>üñ®Ô∏è X√°c Nh·∫≠n In Phi·∫øu</h3>
                        <p>Xu·∫•t kho th√†nh c√¥ng!</p>
                    </div>
                </div>
            </div>
            
            <div class="modal-body modern-body">
                <div class="confirmation-content">
                    <div class="success-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h4>Xu·∫•t kho th√†nh c√¥ng!</h4>
                    <p>B·∫°n c√≥ mu·ªën in phi·∫øu xu·∫•t kho kh√¥ng?</p>
                    <div class="transaction-info" id="transactionInfo">
                        <!-- Transaction details will be populated here -->
                    </div>
                </div>
            </div>
            
            <div class="modal-footer modern-footer">
                <button type="button" class="btn btn-cancel" onclick="closePrintConfirmModal()">
                    <i class="fas fa-times"></i>
                    Kh√¥ng in
                </button>
                <button type="button" class="btn btn-print" onclick="confirmPrintReceipt()">
                    <i class="fas fa-print"></i>
                    In phi·∫øu xu·∫•t kho
                </button>
            </div>
        </div>
    </div>

    <!-- Single Product Delete Confirmation Modal -->
    <div id="deleteConfirmModal" class="modal modern-modal">
        <div class="modal-overlay"></div>
        <div class="modal-content delete-confirm-modal">
            <div class="modal-header gradient-header">
                <div class="header-content">
                    <div class="header-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="header-text">
                        <h3>‚ö†Ô∏è X√°c Nh·∫≠n X√≥a S·∫£n Ph·∫©m</h3>
                        <p>X√≥a s·∫£n ph·∫©m kh·ªèi kho h√†ng</p>
                    </div>
                </div>
            </div>
            
            <div class="modal-body modern-body">
                <div class="confirmation-content">
                    <div class="warning-icon">
                        <i class="fas fa-exclamation-circle"></i>
                    </div>
                    <h4>X√°c nh·∫≠n x√≥a s·∫£n ph·∫©m</h4>
                    <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a s·∫£n ph·∫©m n√†y kh√¥ng? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.</p>
                    <div class="product-info" id="deleteProductInfo">
                        <!-- Product details will be populated here -->
                    </div>
                </div>
            </div>
            
            <div class="modal-footer modern-footer">
                <button type="button" class="btn btn-cancel" onclick="closeDeleteConfirmModal()">
                    <i class="fas fa-times"></i>
                    H·ªßy
                </button>
                <button type="button" class="btn btn-danger" onclick="confirmDeleteProduct()">
                    <i class="fas fa-trash"></i>
                    X√≥a s·∫£n ph·∫©m
                </button>
            </div>
        </div>
    </div>

    <!-- Bulk Product Delete Confirmation Modal -->
    <div id="bulkDeleteConfirmModal" class="modal modern-modal">
        <div class="modal-overlay"></div>
        <div class="modal-content bulk-delete-confirm-modal">
            <div class="modal-header gradient-header">
                <div class="header-content">
                    <div class="header-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="header-text">
                        <h3>‚ö†Ô∏è X√°c Nh·∫≠n X√≥a Nhi·ªÅu S·∫£n Ph·∫©m</h3>
                        <p>X√≥a c√°c s·∫£n ph·∫©m ƒë√£ ch·ªçn kh·ªèi kho h√†ng</p>
                    </div>
                </div>
            </div>
            
            <div class="modal-body modern-body">
                <div class="confirmation-content">
                    <div class="warning-icon">
                        <i class="fas fa-exclamation-circle"></i>
                    </div>
                    <h4>X√°c nh·∫≠n x√≥a c√°c s·∫£n ph·∫©m ƒë√£ ch·ªçn</h4>
                    <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a <span id="bulkDeleteSelectedCount">0</span> s·∫£n ph·∫©m n√†y kh√¥ng? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.</p>
                    <div class="product-list" id="bulkDeleteProductList">
                        <!-- Selected product list will be populated here -->
                    </div>
                </div>
            </div>
            
            <div class="modal-footer modern-footer">
                <button type="button" class="btn btn-cancel" onclick="closeBulkDeleteConfirmModal()">
                    <i class="fas fa-times"></i>
                    H·ªßy
                </button>
                <button type="button" class="btn btn-danger" onclick="confirmBulkDeleteProducts()">
                    <i class="fas fa-trash"></i>
                    X√≥a c√°c s·∫£n ph·∫©m
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <!-- Scripts -->
    <script src="../main/firebase.js"></script>
    <script src="../main/navbar.js"></script>
    <script src="../main/warehouse-core.js"></script>
    <script src="../main/warehouse-view-toggle.js"></script>
    <script src="../main/warehouse-usage-report-enhanced.js"></script>
    <script>
        // Number formatting functions
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }

        function unformatNumber(str) {
            return str.replace(/,/g, '');
        }

        function addNumberFormatting(inputId) {
            const input = document.getElementById(inputId);
            if (!input) return;
            
            input.addEventListener('input', function(e) {
                let value = e.target.value.replace(/,/g, '');
                if (!isNaN(value) && value !== '') {
                    e.target.value = formatNumber(value);
                }
            });
            
            input.addEventListener('blur', function(e) {
                let value = e.target.value.replace(/,/g, '');
                if (!isNaN(value) && value !== '') {
                    e.target.value = formatNumber(value);
                }
            });
            
            input.addEventListener('focus', function(e) {
                e.target.value = unformatNumber(e.target.value);
            });
        }

        function toggleCustomReason() {
            const reasonSelect = document.getElementById('stockOutReason');
            const customReasonDiv = document.getElementById('customReasonDiv');
            
            if (reasonSelect && customReasonDiv) {
                if (reasonSelect.value === 'other') {
                    customReasonDiv.style.display = 'block';
                    customReasonDiv.querySelector('input').required = true;
                } else {
                    customReasonDiv.style.display = 'none';
                    customReasonDiv.querySelector('input').required = false;
                }
            }
        }
        
        function getReasonText(reason, customReason) {
            if (reason === 'other' && customReason) {
                return customReason;
            }
            const reasonMap = {
                'damaged': 'H√†ng h·ªèng',
                'expired': 'H·∫øt h·∫°n s·ª≠ d·ª•ng',
                'sold': 'ƒê√£ b√°n',
                'returned': 'Tr·∫£ h√†ng',
                'other': 'Kh√°c'
            };
            return reasonMap[reason] || reason;
        }
        
    
    </script>
</body>
</html>
